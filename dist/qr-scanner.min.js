var QrScanner=function(){var c=function(a,b,d){d=void 0===d?c.DEFAULT_CANVAS_SIZE:d;this.$video=a;this.$canvas=document.createElement("canvas");this._onDecode=b;this._paused=this._active=!1;this.$canvas.width=d;this.$canvas.height=d;this._sourceRect={x:0,y:0,width:d,height:d};this._onCanPlay=this._onCanPlay.bind(this);this._onPlay=this._onPlay.bind(this);this._onVisibilityChange=this._onVisibilityChange.bind(this);this.$video.addEventListener("canplay",this._onCanPlay);this.$video.addEventListener("play",
this._onPlay);document.addEventListener("visibilitychange",this._onVisibilityChange);this._qrWorker=new Worker(c.WORKER_PATH)};c.hasCamera=function(){return navigator.mediaDevices.enumerateDevices().then(function(a){return a.some(function(a){return"videoinput"===a.kind})}).catch(function(){return!1})};c.prototype.destroy=function(){this.$video.removeEventListener("canplay",this._onCanPlay);this.$video.removeEventListener("play",this._onPlay);document.removeEventListener("visibilitychange",this._onVisibilityChange);
this.stop();this._qrWorker.postMessage({type:"close"})};c.prototype.start=function(){var a=this;if(this._active&&!this._paused)return Promise.resolve();"https:"!==window.location.protocol&&console.warn("The camera stream is only accessible if the page is transferred via https.");this._active=!0;this._paused=!1;if(document.hidden)return Promise.resolve();clearTimeout(this._offTimeout);this._offTimeout=null;if(this.$video.srcObject)return this.$video.play(),Promise.resolve();var b="environment";return this._getCameraStream("environment",
!0).catch(function(){b="user";return a._getCameraStream()}).then(function(d){a.$video.srcObject=d;a._setVideoMirror(b)}).catch(function(b){a._active=!1;throw b;})};c.prototype.stop=function(){this.pause();this._active=!1};c.prototype.pause=function(){var a=this;this._paused=!0;this._active&&(this.$video.pause(),this._offTimeout||(this._offTimeout=setTimeout(function(){var b=a.$video.srcObject&&a.$video.srcObject.getTracks()[0];b&&(b.stop(),a.$video.srcObject=null,a._offTimeout=null)},300)))};c.scanImage=
function(a,b,d,f,e,h){b=void 0===b?null:b;d=void 0===d?null:d;f=void 0===f?null:f;e=void 0===e?!1:e;h=void 0===h?!1:h;var k=!1,g=new Promise(function(h,g){d||(d=new Worker(c.WORKER_PATH),k=!0,d.postMessage({type:"inversionMode",data:"both"}));var m=function(a){"qrResult"===a.data.type&&(d.removeEventListener("message",m),d.removeEventListener("error",l),clearTimeout(n),null!==a.data.data?h(a.data.data):g("QR code not found."))};var l=function(a){d.removeEventListener("message",m);d.removeEventListener("error",
l);clearTimeout(n);g("Scanner error: "+(a?a.message||a:"Unknown Error"))};d.addEventListener("message",m);d.addEventListener("error",l);var n=setTimeout(function(){return l("timeout")},3E3);c._loadImage(a).then(function(a){a=c._getImageData(a,b,f,e);d.postMessage({type:"decode",data:a},[a.data.buffer])}).catch(l)});b&&h&&(g=g.catch(function(){return c.scanImage(a,null,d,f,e)}));return g=g.finally(function(){k&&d.postMessage({type:"close"})})};c.prototype.setGrayscaleWeights=function(a,b,d,c){this._qrWorker.postMessage({type:"grayscaleWeights",
data:{red:a,green:b,blue:d,useIntegerApproximation:void 0===c?!0:c}})};c.prototype.setInversionMode=function(a){this._qrWorker.postMessage({type:"inversionMode",data:a})};c.prototype._onCanPlay=function(){this._updateSourceRect();this.$video.play()};c.prototype._onPlay=function(){this._updateSourceRect();this._scanFrame()};c.prototype._onVisibilityChange=function(){document.hidden?this.pause():this._active&&this.start()};c.prototype._updateSourceRect=function(){var a=Math.round(2/3*Math.min(this.$video.videoWidth,
this.$video.videoHeight));this._sourceRect.width=this._sourceRect.height=a;this._sourceRect.x=(this.$video.videoWidth-a)/2;this._sourceRect.y=(this.$video.videoHeight-a)/2};c.prototype._scanFrame=function(){var a=this;if(!this._active||this.$video.paused||this.$video.ended)return!1;requestAnimationFrame(function(){c.scanImage(a.$video,a._sourceRect,a._qrWorker,a.$canvas,!0).then(a._onDecode,function(b){a._active&&"QR code not found."!==b&&console.error(b)}).then(function(){return a._scanFrame()})})};
c.prototype._getCameraStream=function(a,b){b=void 0===b?!1:b;var d=[{width:{min:1024}},{width:{min:768}},{}];a&&(b&&(a={exact:a}),d.forEach(function(b){return b.facingMode=a}));return this._getMatchingCameraStream(d)};c.prototype._getMatchingCameraStream=function(a){var b=this;return 0===a.length?Promise.reject("Camera not found."):navigator.mediaDevices.getUserMedia({video:a.shift()}).catch(function(){return b._getMatchingCameraStream(a)})};c.prototype._setVideoMirror=function(a){this.$video.style.transform=
"scaleX("+("user"===a?-1:1)+")"};c._getImageData=function(a,b,d,c){b=void 0===b?null:b;c=void 0===c?!1:c;d=(void 0===d?null:d)||document.createElement("canvas");var e=b&&b.x?b.x:0,f=b&&b.y?b.y:0,k=b&&b.width?b.width:a.width||a.videoWidth;b=b&&b.height?b.height:a.height||a.videoHeight;c||d.width===k&&d.height===b||(d.width=k,d.height=b);c=d.getContext("2d",{alpha:!1});c.imageSmoothingEnabled=!1;c.drawImage(a,e,f,k,b,0,0,d.width,d.height);return c.getImageData(0,0,d.width,d.height)};c._loadImage=function(a){if(a instanceof
HTMLCanvasElement||a instanceof HTMLVideoElement||window.ImageBitmap&&a instanceof window.ImageBitmap||window.OffscreenCanvas&&a instanceof window.OffscreenCanvas)return Promise.resolve(a);if(a instanceof Image)return c._awaitImageLoad(a).then(function(){return a});if(a instanceof File||a instanceof URL||"string"===typeof a){var b=new Image;b.src=a instanceof File?URL.createObjectURL(a):a;return c._awaitImageLoad(b).then(function(){a instanceof File&&URL.revokeObjectURL(b.src);return b})}return Promise.reject("Unsupported image type.")};
c._awaitImageLoad=function(a){return new Promise(function(b,d){if(a.complete&&0!==a.naturalWidth)b();else{var c=function(){a.removeEventListener("load",c);a.removeEventListener("error",e);b()};var e=function(){a.removeEventListener("load",c);a.removeEventListener("error",e);d("Image load error")};a.addEventListener("load",c);a.addEventListener("error",e)}})};c.DEFAULT_CANVAS_SIZE=400;c.WORKER_PATH="qr-scanner-worker.min.js";return c}();
//# sourceMappingURL=qr-scanner.min.js.map
